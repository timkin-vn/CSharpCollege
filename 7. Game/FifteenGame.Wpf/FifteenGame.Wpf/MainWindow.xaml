<Window x:Class="FifteenGame.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Три в ряд" Height="675" Width="550"
        ResizeMode="NoResize">


    <Window.DataContext>
        <local:MainWindowViewModel xmlns:local="clr-namespace:FifteenGame.Wpf.ViewModels" />
    </Window.DataContext>

    <Grid Background="LightBlue">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="{Binding GameStatus}" 
                   FontSize="20" FontWeight="Bold" 
                   HorizontalAlignment="Center" Margin="10"/>

        <Button Grid.Row="1" Content="Новая игра" Command="{Binding NewGameCommand}" 
                Margin="10" Padding="10" FontSize="14" HorizontalAlignment="Center"/>

        <Border Grid.Row="2" Margin="20" Background="White" BorderBrush="DarkBlue" BorderThickness="3">
            <ItemsControl ItemsSource="{Binding Cells}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid Background="LightYellow">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Command="{Binding ClickCommand}" 
                                CommandParameter="{Binding}"
                                Margin="2"
                                Background="Transparent"
                                BorderThickness="0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid>
                                        <!-- Фон ячейки -->
                                        <Border x:Name="CellBackground" 
                                                Background="Transparent" 
                                                BorderBrush="Transparent" 
                                                BorderThickness="0"
                                                CornerRadius="8"/>

                                        <!-- Драгоценность -->
                                        <Ellipse x:Name="Gem" 
                                                 Fill="{Binding GemColor}" 
                                                 Stroke="Black" 
                                                 StrokeThickness="1.5"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Stretch"/>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                            <Setter TargetName="CellBackground" Property="Background" Value="Gold"/>
                                            <Setter TargetName="CellBackground" Property="BorderBrush" Value="DarkOrange"/>
                                            <Setter TargetName="CellBackground" Property="BorderThickness" Value="3"/>
                                            <Setter TargetName="Gem" Property="Stroke" Value="DarkOrange"/>
                                            <Setter TargetName="Gem" Property="StrokeThickness" Value="2.5"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsMatched}" Value="True">
                                            <Setter TargetName="CellBackground" Property="Background" Value="LightGreen"/>
                                        </DataTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>

                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Grid.Row" Value="{Binding Row}" />
                        <Setter Property="Grid.Column" Value="{Binding Column}" />
                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                        <Setter Property="VerticalAlignment" Value="Stretch" />
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
        </Border>
    </Grid>
</Window>