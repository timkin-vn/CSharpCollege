@model _2048Game.Web.Models.GameViewModel
@{
    ViewBag.Title = "Sokoban";
}

<h2 class="title">Sokoban</h2>

<div class="meta">
    <span>Remaining boxes: <strong>@Model.RemainingBoxes</strong></span>
    <span style="margin-left:20px">Remaining targets: <strong>@Model.RemainingTargets</strong></span>
</div>

<div class="score-box">
    <span>Ходов: <strong>@Model.MoveCount</strong></span>
</div>

<div id="game-container" style="width:520px;">
    <div id="board">
        @Html.Partial("_Board", Model)
    </div>

    @if (Model.HasWon)
    {
        <div id="game-over-overlay">
            <div class="message">
                Победа! <br />
                <span>Сделано ходов: <strong>@Model.MoveCount</strong></span><br /><br />
                <button onclick="reset()">Начать заново</button>
            </div>
        </div>
    }
</div>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function move(dir) {
            $.post('/Game/Move', { direction: dir }, function (data) {
                $('#game-container').html($(data).find('#game-container').html());
                $('.score-box').html($(data).find('.score-box').html());
                $('.meta').html($(data).find('.meta').html());
            });
        }

        function reset() {
            window.location.href = '/Game/Reset';
        }

        document.addEventListener('keydown', function (e) {
            switch (e.key) {
                case 'ArrowUp': move('Up'); break;
                case 'ArrowDown': move('Down'); break;
                case 'ArrowLeft': move('Left'); break;
                case 'ArrowRight': move('Right'); break;
            }
        });
    </script>
}

<style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background: #f7f4ef;
        text-align: center;
    }

    .title {
        font-size: 44px;
        margin-top: 16px;
        color: #5a3f33;
        font-weight: 700;
    }

    .meta {
        font-size: 14px;
        color: #333;
        margin-top: 6px
    }

    .score-box {
        font-size: 18px;
        margin: 10px;
        color: #333;
    }

    #game-container {
        position: relative;
        display: inline-block;
        margin-top: 18px;
        padding: 18px;
        background: rgba(255,255,255,0.8);
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.06);
    }

    .board {
        border-collapse: separate;
        border-spacing: 8px;
        background-color: transparent;
    }

        .board td {
            width: 44px;
            height: 44px;
            text-align: center;
            vertical-align: middle;
            font-size: 20px;
            border-radius: 4px;
            color: #222;
            box-shadow: inset 0 0 0 2px rgba(0,0,0,0.06), 0 2px 0 rgba(255,255,255,0.5) inset;
            transition: background .08s ease;
        }


    .tile-wall {
        background: #28a745;
        color: #fff;
        box-shadow: none;
    }
    /* green */
    .tile-box {
        background: #40E0D0;
        color: #012;
    }
    /* brown -> turquoise */
    .tile-target {
        background: rgba(255,255,255,0.3);
        color: #000;
    }

    .tile-player {
        background: #e53935;
        color: #fff;
        font-weight: 700
    }
    /* red */
    .tile-box-target {
        background: #2bbbad;
        color: #fff;
    }
    /* box on target (teal variant) */
    .tile-player-target {
        background: #e57373;
        color: #fff;
    }
    /* player on target (red variant) */
    .tile-empty {
        background: #efeae5;
    }

    #game-over-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
    }

        #game-over-overlay .message {
            background: #fff;
            color: #222;
            font-size: 20px;
            padding: 20px 30px;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        #game-over-overlay button {
            margin-top: 10px;
            padding: 8px 14px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            background: #4a8;
            color: #fff;
            cursor: pointer;
        }
</style>